<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Browse Tor with Claude using curl over socks5h: simple setup, fast lookups via Ahmia, and how to prompt Claude to find and skim .onion sites like a search engine.">
  <meta name="author" content="Storbeck">
  <title>Browse Tor with Claude (curl + socks5h) - Storbeck Blog</title>
  <link rel="preconnect" href="https://github.com">
  <link rel="dns-prefetch" href="https://www.linkedin.com">
  <meta itemprop="author" content="Geoff Storbeck">
  <meta itemprop="headline" content="Browse Tor with Claude (curl + socks5h)">
  <meta itemprop="datePublished" content="2025-10-16">
  <meta itemprop="description" content="Use curl through Tor’s SOCKS proxy from Claude’s Bash tool. Verify Tor egress, understand .onion limitations, and use socks5h correctly.">
  <meta itemprop="url" content="https://storbeck.dev/posts/2025-10-16-tor-proxy-cli.html">
  <meta itemprop="mainEntityOfPage" content="https://storbeck.dev/posts/2025-10-16-tor-proxy-cli.html">
  <meta itemprop="inLanguage" content="en">
  <meta itemprop="genre" content="Blog">
  <meta name="robots" content="index,follow">
  <meta name="referrer" content="no-referrer">
  <meta name="format-detection" content="telephone=no">
  <meta name="theme-color" content="#ffffff">
</head>
<body>
  <header>
    <nav aria-label="Site navigation">
      <a href="../index.html" rel="home">← Storbeck Blog</a>
    </nav>
  </header>

  <main>
    <article itemscope itemtype="http://schema.org/BlogPosting">
      <header>
        <h1 itemprop="headline">Browse the Tor Network with Claude (curl + socks5h)</h1>
        <p>
          <time datetime="2025-10-16" itemprop="datePublished">Published October 16, 2025</time>
          <span> • </span>
          <span>Networking, Tools</span>
        </p>
      </header>

      <section>
        <h2>What you get</h2>
        <p>Claude can “browse the Tor Network" by running <code>curl</code> through your local Tor proxy. Both DNS and HTTP(S) stay inside Tor, so <code>.onion</code> works. With Ahmia, Claude can act like a simple search engine for onions: find candidates, fetch headers, skim first lines, and report back fast.</p>
        <ul>
          <li>Proxy: <code>127.0.0.1:9050</code> (Tor SOCKS)</li>
          <li>Mode: <code>socks5h</code> (Tor resolves hostnames)</li>
        </ul>
      </section>

      

      <section>
        <h2>Quick start (Fedora)</h2>
        <pre><code>sudo dnf install tor
sudo systemctl enable --now tor
sudo ss -ltn | grep ':9050'   # expect 127.0.0.1:9050
</code></pre>
      </section>

      <section>
        <h2>Use with curl</h2>
        <p>One‑off:</p>
        <pre><code>curl --socks5-hostname 127.0.0.1:9050 http://exampleonion.onion/
</code></pre>
        <p>Or set an env var for the session:</p>
        <pre><code>export ALL_PROXY=socks5h://127.0.0.1:9050
curl http://exampleonion.onion/
</code></pre>
        <p><strong>Important:</strong> use <code>socks5h</code> (or <code>--socks5-hostname</code>) so Tor does the DNS resolution. Plain <code>socks5</code> won’t resolve <code>.onion</code>.</p>
      </section>

      <section>
        <h2>Verify it works</h2>
        <pre><code>curl -sS --socks5-hostname 127.0.0.1:9050 https://check.torproject.org/api/ip
# Expect: {"IsTor": true, ...}
</code></pre>
      </section>

      

      <section>
        <h2>Ask Claude like a search engine</h2>
        <p>Prompt Claude in plain English, it will run the Ahmia query via <code>curl</code> over Tor and list candidate onions:</p>
        <pre><code>"find me academic research repository onions"

● Bash(QUERY='research+papers' curl -sS --socks5-hostname 127.0.0.1:9050 …)
  ⎿  2222f2ikw4c6x4sljqbtalrqz5ngfoizmw3uyvont3tqkehdpmtdayqd.onion
     2gzyxa5i5ayvgbqn6r7r37fzapdf5fp6vxtxqymxoa6cocwemjgs5nyd.onion
     2gzyxa5ihm7nsggfxnu52rck2vv4rvmdlkiu3zzui5du4xyclen53wid.onion
     … +12 lines (ctrl+r to expand)

● Bash(QUERY='thesis+dissertation' curl -sS --socks5-hostname 127.0.0.1:9050 …)
  ⎿  Running…

● Bash(QUERY='digital+library' curl -sS --socks5-hostname 127.0.0.1:9050 …)
  ⎿  Waiting…
     ctrl+b to run in background
</code></pre>
        <p>Under the hood, it’s just Ahmia plus a small filter for v3 onion hostnames:</p>
        <pre><code>QUERY='research+papers'
BASE='http://juhanurmihxlp77nkq76byazcldy2hlmovfu2epvl5ankdibsot4csyd.onion'
curl -sS --socks5-hostname 127.0.0.1:9050 "$BASE/search/?q=${QUERY}" | \
  grep -Eo 'https?://[a-z2-7]{56}\.onion' | sort -u | head -n 20
</code></pre>
        <p>To skim content quickly, fetch headers or the first lines from each host:</p>
        <pre><code>curl -sS -I --socks5-hostname 127.0.0.1:9050 http://EXAMPLE.onion/
curl -sS    --socks5-hostname 127.0.0.1:9050 http://EXAMPLE.onion/ | head -n 20
</code></pre>
      </section>

      <section>
        <h2>Troubleshooting</h2>
        <ul>
          <li>Tor not running: <code>systemctl status tor</code></li>
          <li>No <code>.onion</code> resolution: curl needs <code>socks5h</code>; plain curl won't resolve <code>.onion</code> (RFC 7686). Use <code>--socks5-hostname</code> or <code>ALL_PROXY=socks5h://...</code>.</li>
          <li>WebFetch: doesn't use a SOCKS proxy, so it won't reach <code>.onion</code>. Use Bash + <code>curl</code> with <code>socks5h</code>.</li>
        </ul>
      </section>

      <section>
        <h2>Claude Code profile (copy‑paste)</h2>
        <p>Drop this into your Claude project as <code>CLAUDE.md</code>. It tells Claude to use the Bash tool with <code>curl</code> over Tor and how to search/skim onions via Ahmia.</p>
        <pre><code># Claude Code: Tor browsing via curl (.onion ready)

Purpose
- Use curl through your local Tor SOCKS proxy from the Bash tool. Don't proxy Claude itself. WebFetch doesn't use SOCKS proxies, so it won't reach .onion. Using socks5h keeps DNS + HTTP inside Tor.

Assumptions
- Tor running locally with SOCKS on 127.0.0.1:9050
- Bash tool available in Claude Code

Rules
- Use Bash + curl instead of WebFetch for .onion
- Route curl via Tor:
  - Per command: --socks5-hostname 127.0.0.1:9050
  - Or session-wide: export ALL_PROXY=socks5h://127.0.0.1:9050
- Use -sS to show errors without the progress bar

Sanity check (clearnet via Tor)
curl -sS --socks5-hostname 127.0.0.1:9050 https://check.torproject.org/api/ip
# Expect: {"IsTor": true, ...}

Ahmia basics
BASE='http://juhanurmihxlp77nkq76byazcldy2hlmovfu2epvl5ankdibsot4csyd.onion'

1) Headers (reachability)
curl -sS -I --socks5-hostname 127.0.0.1:9050 "$BASE/"

2) Search and extract v3 onion candidates (dedup)
QUERY='marketplace'
curl -sS --socks5-hostname 127.0.0.1:9050 "$BASE/search/?q=${QUERY}" | \
  grep -Eo 'https?://[a-z2-7]{56}\.onion' | sort -u | head -n 10

3) Probe one host, then fetch a snippet
HOST='EXAMPLE.onion'
curl -sS -I --socks5-hostname 127.0.0.1:9050 "http://$HOST/" | sed -n '1,12p'
curl -sS    --socks5-hostname 127.0.0.1:9050 "http://$HOST/" | head -n 20

Notes
- .onion needs DNS inside Tor (RFC 7686). curl must use socks5h: --socks5-hostname or ALL_PROXY=socks5h://...
- WebFetch won't use a SOCKS proxy; use Bash + curl
- Sites are intermittent; small timeouts and retries help
</code></pre>
      </section>
      <section>
        <h2>See also</h2>
        <ul>
          <li><a href="https://curl.se/docs/manpage.html" rel="external noopener noreferrer">curl manual</a></li>
          <li><a href="https://community.torproject.org/" rel="external noopener noreferrer">Tor Project community</a></li>
          <li><a href="https://www.rfc-editor.org/rfc/rfc7686" rel="external noopener noreferrer">RFC 7686: The .onion Special-Use Domain Name</a></li>
        </ul>
      </section>
    </article>
  </main>

  <aside>
    <section>
      <h2>See also</h2>
      <ul>
        <li>curl with <code>socks5h</code> (DNS inside Tor)</li>
        <li>Using Claude’s Bash tool to drive curl over Tor</li>
      </ul>
    </section>
  </aside>

  <footer>
    <nav aria-label="Post navigation">
      <a href="../index.html" rel="home">← Back to blog</a>
    </nav>
    <p><small>Last updated: <time datetime="2025-10-16">October 16, 2025</time></small></p>
  </footer>
</body>
</html>
