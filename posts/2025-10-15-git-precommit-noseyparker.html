<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Add a one-minute pre-commit secret scan using Nosey Parker so accidental credentials don’t reach Git.">
  <meta name="author" content="Storbeck">
  <title>Preventing Secrets from Leaking in Git Repos (Pre‑commit Hook) - Storbeck Blog</title>
  <link rel="preconnect" href="https://github.com">
  <link rel="dns-prefetch" href="https://www.linkedin.com">
  <meta itemprop="author" content="Geoff Storbeck">
  <meta itemprop="headline" content="Preventing Secrets from Leaking in Git Repos (Pre‑commit Hook)">
  <meta itemprop="datePublished" content="2025-10-15">
  <meta itemprop="description" content="Minimal Git hook: scan staged changes for secrets with Nosey Parker and block commits with findings.">
  <meta itemprop="url" content="https://storbeck.dev/posts/2025-10-15-git-precommit-noseyparker.html">
  <meta itemprop="mainEntityOfPage" content="https://storbeck.dev/posts/2025-10-15-git-precommit-noseyparker.html">
  <meta itemprop="inLanguage" content="en">
  <meta itemprop="genre" content="Blog">
</head>
<body>
  <header>
    <nav aria-label="Site navigation">
      <a href="../index.html" rel="home">← Storbeck Blog</a>
    </nav>
  </header>

  <main>
    <article itemscope itemtype="http://schema.org/BlogPosting">
      <header>
        <h1 itemprop="headline">Preventing Secrets from Leaking in Git Repos (Pre‑commit Hook)</h1>
        <p>
          <time datetime="2025-10-15" itemprop="datePublished">Published October 15, 2025</time>
          <span> • </span>
          <span>Security</span>
        </p>
      </header>

      <section aria-labelledby="why">
        <h2 id="why">Why</h2>
        <p>AI‑assisted coding speeds things up—but it’s easy to accidentally stage tokens or credentials. A tiny Git pre‑commit hook can scan staged files and block risky commits automatically.</p>
      </section>

      <section aria-labelledby="setup">
        <h2 id="setup">Setup</h2>
        <ol>
          <li>Install Nosey Parker: <a href="https://github.com/praetorian-inc/noseyparker" rel="external noopener noreferrer">github.com/praetorian-inc/noseyparker</a></li>
          <li>Create a hooks folder and add the hook:
            <pre><code>mkdir -p .githooks
cat &gt; .githooks/pre-commit &lt;&lt; 'HOOK'
#!/usr/bin/env bash
set -euo pipefail
if ! command -v noseyparker >/dev/null 2>&1; then
  echo "[noseyparker] Not installed. Install: https://github.com/praetorian-inc/noseyparker"
  echo "[noseyparker] Proceeding without scan."
  exit 0
fi
mapfile -t FILES &lt; &lt;(git diff --cached --name-only --diff-filter=ACMR)
[[ ${#FILES[@]} -eq 0 ]] &amp;&amp; exit 0
TMPDIR=$(mktemp -d 2&gt;/dev/null || mktemp -d -t np)
trap 'rm -rf "$TMPDIR"' EXIT INT TERM
for f in "${FILES[@]}"; do
  if git cat-file -e ":$f" 2&gt;/dev/null; then
    mkdir -p "$TMPDIR/$(dirname "$f")"
    git show ":$f" &gt; "$TMPDIR/$f" || true
  fi
done
DATASTORE="$TMPDIR/datastore"
noseyparker scan --datastore "$DATASTORE" "$TMPDIR" &gt;/dev/null 2&gt;&1 || { echo "[noseyparker] scan failed"; exit 1; }
REPORT=$(noseyparker report --datastore "$DATASTORE" 2&gt;/dev/null || true)
if [[ -n "$(echo "$REPORT" | sed 's/[[:space:]]//g')" ]]; then
  echo "[noseyparker] Potential secrets detected in staged changes."; echo "---"; echo "$REPORT" | sed -n '1,200p'; echo "---"; exit 1; fi
exit 0
HOOK
chmod +x .githooks/pre-commit</code></pre>
          </li>
          <li>Tell Git to use the hooks folder for this repo:
            <pre><code>git config core.hooksPath .githooks</code></pre>
          </li>
        </ol>
        <p>The hook scans only <em>staged</em> changes and blocks the commit if it finds likely secrets.</p>
      </section>

      <section aria-labelledby="test">
        <h2 id="test">Quick Test</h2>
        <p>Create a throwaway file that looks like a secret and try to commit it. The hook should block and print a short report.</p>
        <pre><code>printf "AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE\nAWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\n" &gt; tmp-secret.env
git add tmp-secret.env
GIT_TRACE=1 GIT_TRACE_SETUP=1 git commit -m "test: should be blocked by noseyparker"</code></pre>
        <p>Example output (truncated):</p>
        <pre><code>[noseyparker] Potential secrets detected in staged changes.
---
Finding 1: AWS Access Key ID
  File: tmp-secret.env:1
  Match: AKIAIOSFODNN7EXAMPLE
Finding 2: AWS Secret Access Key
  File: tmp-secret.env:2
  Match: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
---
Aborting commit.</code></pre>
        <p>Clean up and confirm a clean commit:</p>
        <pre><code>git reset HEAD tmp-secret.env
rm tmp-secret.env
git commit -m "clean commit"</code></pre>
      </section>

      <section aria-labelledby="how">
        <h2 id="how">What the Hook Does</h2>
        <ul>
          <li>Materializes staged files into a temp directory</li>
          <li>Runs <code>noseyparker scan</code> on that temp directory</li>
          <li>Prints a brief <code>noseyparker report</code> and blocks on findings</li>
        </ul>
        <p>Hook path in this repo: <code>.githooks/pre-commit</code>.</p>
      </section>

      <section aria-labelledby="credit">
        <h2 id="credit">Credit</h2>
        <p>Nosey Parker is an open‑source project by <a href="https://github.com/praetorian-inc/noseyparker" rel="external noopener noreferrer">Praetorian</a>. A shout‑out to my former coworker <a href="https://github.com/bradlarsen" rel="external noopener noreferrer">Brad Larsen</a>, a machine learning expert, whose work and advocacy for practical guardrails inspired adding this minimal hook to keep AI‑era coding safer.</p>
      </section>

      <section aria-labelledby="notes">
        <h2 id="notes">Notes</h2>
        <ul>
          <li>This is a minimal example to keep friction low; improve as needed for your workflow.</li>
          <li>Rotate any credential that was ever committed—even briefly.</li>
          <li>For CI coverage, run Nosey Parker in your PR pipeline as well.</li>
        </ul>
      </section>
    </article>
  </main>

  <aside>
    <section>
      <h2>Related Topics</h2>
      <ul>
        <li><a href="https://github.com/praetorian-inc/noseyparker" rel="external noopener noreferrer">Nosey Parker</a></li>
        <li><a href="https://github.com/bradlarsen" rel="external noopener noreferrer">Brad Larsen</a></li>
      </ul>
    </section>
  </aside>

  <footer>
    <nav aria-label="Post navigation">
      <a href="../index.html" rel="home">← Back to blog</a>
    </nav>
    <p><small>Last updated: <time datetime="2025-10-15">October 15, 2025</time></small></p>
  </footer>
</body>
</html>
